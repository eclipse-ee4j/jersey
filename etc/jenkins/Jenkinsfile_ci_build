pipeline {
    agent none

    options {
          timeout(time: 30, activity: true, unit: 'HOURS')
          buildDiscarder(logRotator(numToKeepStr:'15', artifactNumToKeepStr: '2' ))
          disableConcurrentBuilds()
    }

    stages {
        stage('Jersey build') {
            parallel {
                stage('JDK 11') {
                    agent {
                        label 'centos-7'
                    }
                    tools {
                        jdk 'openjdk-jdk11-latest'
                        maven 'apache-maven-latest'
                    }
                    steps {
                        sh '''
                                bash ${WORKSPACE}/etc/jenkins/jenkins_build.sh
                                bash ${WORKSPACE}/etc/scripts/validation/dependency-convergence.sh
                            '''
                    }
                }
                stage('JDK 21') {
                    agent {
                        label 'centos-7'
                    }
                    tools {
                        jdk 'openjdk-jdk21-latest'
                        maven 'apache-maven-latest'
                    }
                    steps {
                        sh '''
                                bash ${WORKSPACE}/etc/jenkins/jenkins_build.sh
                                export EXCLUDE_ARGS=' -pl !:jersey-container-jetty11-http,!:jersey-jetty11-connector '
                                bash ${WORKSPACE}/etc/scripts/validation/dependency-convergence.sh
                            '''
                    }
                }
            }
        }
    }
}
